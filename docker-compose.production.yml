# ─────────────────────────────────────────────────────────
# Basecamp Social — Production Overrides
# ─────────────────────────────────────────────────────────
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.production.yml up -d
#
# Requires .env.production (see .env.production.example)
# ─────────────────────────────────────────────────────────

services:
  postgres:
    restart: always
    # No host ports exposed — only accessible from within the Docker network

  redis:
    restart: always
    command: redis-server --requirepass ${REDIS_PASSWORD}
    # No host ports exposed

  minio:
    restart: always
    ports:
      - "${MINIO_API_PORT:-9000}:9000"
    # No console port exposed in production

  api:
    restart: always
    ports:
      - "${API_PORT:-8080}:8080"
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      ConnectionStrings__Redis: "redis:6379,password=${REDIS_PASSWORD}"
      S3__BucketName: ${MINIO_BUCKET:-basecamp-social}
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 1024M
        reservations:
          cpus: "0.5"
          memory: 256M
